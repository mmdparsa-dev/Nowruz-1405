<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8" />
<title>شمارش معکوس عید نوروز ۱۴۰۵</title>
<link rel="stylesheet" href="font.css" />
<style>
body {
  margin: 0;
  font-family: 'Vazir Variable', sans-serif;
  background: linear-gradient(135deg, #7A1F1F 0%, #B83232 30%, #E94B4B 60%);
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  overflow: hidden;
  color: #fff;
  user-select: none;
}
.container {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 20px;
  padding: 30px 40px;
  border-radius: 50px;
  background: rgba(0,0,0,0.35);
  backdrop-filter: blur(10px);
  box-shadow: 0 8px 40px rgba(0,0,0,0.35);
}
#link {
  position: fixed;
  bottom: -150px;
  left: 50%;
  transform: translateX(-50%);
  padding: 5px 10px;
  font-size: 20px;
  font-weight: 500;
  color: #fff;
  text-decoration: none;
  border-radius: 15px;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  border: 0.025px solid rgba(255, 255, 255, 0.2);
  z-index: 9999;
  text-align: center;
  transition: 0.3s;
}
#link:hover {
  background: rgba(0, 0, 0, 0.6);
  color: #00aaff;
}
.haftsine-icon { width: 300px; height: auto; }
.countdown {
  display: flex;
  align-items: flex-end;
  justify-content: center;
  gap: clamp(2rem, 6vw, 8rem);
  font-weight: 800;
  font-size: clamp(2rem, 5vw, 3.2rem);
  padding: 16px 20px;
}
.time-unit {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.2rem;
  width: 50px;
}
.time-label {
  font-size: clamp(0.9rem, 2.2vw, 1.05rem);
  font-weight: 700;
  opacity: 0.95;
}
.time-value {
  font-size: clamp(2.4rem, 6vw, 3.4rem);
  line-height: 1;
  transition: transform 0.5s ease, opacity 0.5s ease, filter 0.5s ease;
  letter-spacing: 0.04em;
}
.countdown-title-box {
  font-weight: 600;
  font-size: clamp(1.2rem, 3.2vw, 1.8rem);
  padding: 18px 32px;
  border-radius: 999px;
  background: rgba(255,255,255,0.15);
  backdrop-filter: blur(8px);
  text-align: center;
  box-shadow: 0 4px 15px rgba(0,0,0,0.25);
}
@media (max-width: 420px) {
  .haftsine-icon { width: 220px; }
}
</style>
</head>
<body>
<div class="container" aria-label="شمارش معکوس عید نوروز ۱۴۰۵">
  <img src="Icon(images)/haft-sin.png" alt="هفت‌سین" class="haftsine-icon" />
  <div class="countdown" aria-label="شمارش معکوس تا تحویل سال ۱۴۰۵">
    <div class="time-unit" aria-label="ثانیه">
      <div id="seconds" class="time-value" aria-live="polite">۰۰</div>
      <div class="time-label">ثانیه</div>
    </div>
    <div class="time-unit" aria-label="دقیقه">
      <div id="minutes" class="time-value" aria-live="polite">۰۰</div>
      <div class="time-label">دقیقه</div>
    </div>
    <div class="time-unit" aria-label="ساعت">
      <div id="hours" class="time-value" aria-live="polite">۰۰</div>
      <div class="time-label">ساعت</div>
    </div>
    <div class="time-unit" aria-label="روز">
      <div id="days" class="time-value" aria-live="polite">۰۰</div>
      <div class="time-label">روز</div>
    </div>
    <div class="time-unit" aria-label="ماه">
      <div id="months" class="time-value" aria-live="polite">۰۰</div>
      <div class="time-label">ماه</div>
    </div>
  </div>
  <a href="https://github.com/mmdparsa-dev/Nowruz-1405-" target="_blank" id="link">مشاهده پروژه در GitHub</a>
  <div class="countdown-title-box">زمان باقی‌مانده تا تحویل سال ۱۴۰۵</div>
</div>

<script>
// تبدیل اعداد به فارسی
function toPersianDigits(str) {
  return str.toString().replace(/\d/g, d => '۰۱۲۳۴۵۶۷۸۹'[d]);
}

// بررسی کبیسه شمسی
function isLeapJalali(year) {
  const breaks = [-61, 9, 38, 199, 426, 686, 756, 818, 1111, 1181, 1210, 1635, 2060, 2097, 2192, 2262, 2324, 2394, 2456, 3178];
  let jump = 0, n = 0, i;
  for (i = 0; i < breaks.length; i++) {
    if (year < breaks[i]) break;
    n = breaks[i];
  }
  jump = year - n;
  return (jump % 33) % 4 === 0;
}

// تبدیل میلادی به شمسی
function gregorianToJalali(gy, gm, gd) {
  let g_d_m = [0,31,59,90,120,151,181,212,243,273,304,334];
  let jy = gy - 621;
  let gy2 = (gm > 2) ? (gy + 1) : gy;
  let days = 365*(gy-1600) + Math.floor((gy-1600+3)/4) - Math.floor((gy-1600+99)/100) + Math.floor((gy-1600+399)/400) + gd + g_d_m[gm-1] - 1 - 79;
  let j_np = Math.floor(days / 12053);
  days %= 12053;
  jy = 979 + 33*j_np + 4*Math.floor(days/1461);
  days %= 1461;
  if (days >= 366) {
    jy += Math.floor((days-1)/365);
    days = (days-1)%365;
  }
  let jm = (days < 186) ? 1 + Math.floor(days/31) : 7 + Math.floor((days-186)/30);
  let jd = 1 + ((days < 186) ? (days%31) : ((days-186)%30));
  return [jy, jm, jd];
}

// تاریخ هدف تحویل سال ۱۴۰۵ (۲۰ مارس ۲۰۲۶)
const targetUtc = new Date(Date.UTC(2026,2,20,18,16,30,0));

const elems = {
  months:  document.getElementById('months'),
  days:    document.getElementById('days'),
  hours:   document.getElementById('hours'),
  minutes: document.getElementById('minutes'),
  seconds: document.getElementById('seconds'),
};

const prevValues = {};

function animateChange(elem, newVal) {
  if (!elem || prevValues[elem.id] === newVal) return;
  prevValues[elem.id] = newVal;

  elem.style.transform = 'translateY(-100%)';
  elem.style.opacity   = '0';
  elem.style.filter    = 'blur(6px)';

  setTimeout(() => {
    elem.textContent = newVal;
    elem.style.transition = 'none';
    elem.style.transform  = 'translateY(100%)';
    elem.style.opacity    = '0';
    elem.style.filter     = 'blur(2px)';
    void elem.offsetWidth;

    elem.style.transition = 'transform 1s ease, opacity 1s ease, filter 1s ease';
    elem.style.transform  = 'translateY(0)';
    elem.style.opacity    = '1';
    elem.style.filter     = 'blur(0)';
  }, 500);
}

function update() {
  const now = new Date();
  const diff = targetUtc - now;

  if (diff < 0) return;

  const totalSeconds = Math.floor(diff / 1000);
  const seconds = totalSeconds % 60;
  const totalMinutes = Math.floor(totalSeconds / 60);
  const minutes = totalMinutes % 60;
  const totalHours = Math.floor(totalMinutes / 60);
  const hours = totalHours % 24;
  const totalDays = Math.floor(totalHours / 24);

  // تاریخ فعلی شمسی
  const [jyNow, jmNow, jdNow] = gregorianToJalali(now.getUTCFullYear(), now.getUTCMonth()+1, now.getUTCDate());
  const [jyTarget, jmTarget, jdTarget] = gregorianToJalali(targetUtc.getUTCFullYear(), targetUtc.getUTCMonth()+1, targetUtc.getUTCDate());

  // محاسبه اختلاف دقیق ماه و روز
  let months = (jyTarget - jyNow)*12 + (jmTarget - jmNow);
  let days = jdTarget - jdNow;
  if(days < 0){
    months -= 1;
    const daysInPrevMonth = (jmTarget-1 <=6) ? 31 : (jmTarget-1 <=11) ? 30 : (isLeapJalali(jyTarget)?30:29);
    days += daysInPrevMonth;
  }

  animateChange(elems.months, toPersianDigits(String(months).padStart(2,'0')));
  animateChange(elems.days, toPersianDigits(String(days).padStart(2,'0')));
  animateChange(elems.hours, toPersianDigits(String(hours).padStart(2,'0')));
  animateChange(elems.minutes, toPersianDigits(String(minutes).padStart(2,'0')));
  animateChange(elems.seconds, toPersianDigits(String(seconds).padStart(2,'0')));
}

setInterval(update, 250);
update();
</script>
</body>
</html>
